name: Deploy Portfolio
on:
  push:
    branches:
      - main
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Inject Secrets with Python
        shell: python
        env:
          MY_NAME: ${{ secrets.MY_NAME }}
          MY_ROLE: ${{ secrets.MY_JOB }}
          MY_SPECIALTY: ${{ secrets.MY_SPECIALTY }}
          MY_LOCATION: ${{ secrets.MY_LOCATION }}
          MY_EMAIL: ${{ secrets.MY_EMAIL }}
          MY_PHONE: ${{ secrets.MY_PHONE }}
          MY_AVATAR: ${{ secrets.MY_AVATAR }}
          LINK_FB: ${{ secrets.LINK_FB }}
          LINK_ZALO: ${{ secrets.LINK_ZALO }}
          LINK_DISCORD: ${{ secrets.LINK_DISCORD }}
          LINK_CV: ${{ secrets.LINK_CV }}
          LINK_BGM: ${{ secrets.LINK_BGM }}
          BANK_INFO: ${{ secrets.BANK_INFO }}
          STK_NUMBER: ${{ secrets.STK_NUMBER }}
          QR_LINK: ${{ secrets.QR_LINK }}
          TERMINAL_TITLE: ${{ secrets.TERMINAL_TITLE }}
        run: |
          import os

          with open('index.html', 'r', encoding='utf-8') as f:
              content = f.read()

          # Danh sách các biến cần thay thế
          replacements = {
              "{{MY_NAME}}": os.environ.get('MY_NAME', ''),
              "{{MY_ROLE}}": os.environ.get('MY_ROLE', ''),
              "{{MY_SPECIALTY}}": os.environ.get('MY_SPECIALTY', ''),
              "{{MY_LOCATION}}": os.environ.get('MY_LOCATION', ''),
              "{{MY_EMAIL}}": os.environ.get('MY_EMAIL', ''),
              "{{MY_PHONE}}": os.environ.get('MY_PHONE', ''),
              "{{MY_AVATAR}}": os.environ.get('MY_AVATAR', ''),
              "{{LINK_FB}}": os.environ.get('LINK_FB', ''),
              "{{LINK_ZALO}}": os.environ.get('LINK_ZALO', ''),
              "{{LINK_DISCORD}}": os.environ.get('LINK_DISCORD', ''),
              "{{LINK_CV}}": os.environ.get('LINK_CV', ''),
              "{{LINK_BGM}}": os.environ.get('LINK_BGM', ''),
              "{{BANK_INFO}}": os.environ.get('BANK_INFO', ''),
              "{{STK_NUMBER}}": os.environ.get('STK_NUMBER', ''),
              "{{QR_LINK}}": os.environ.get('QR_LINK', ''),
              "{{TERMINAL_TITLE}}": os.environ.get('TERMINAL_TITLE', '')
          }

          for key, value in replacements.items():
              content = content.replace(key, value)

          with open('index.html', 'w', encoding='utf-8') as f:
              f.write(content)

      - name: Setup Pages
        uses: actions/configure-pages@v4

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: '.'

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
